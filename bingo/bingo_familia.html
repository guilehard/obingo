<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Online da FamÃ­lia</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #fafafa; margin: 0; padding: 20px; user-select: none; }
        h1 { color: #d32f2f; margin-bottom: 10px; }
        
        /* Status */
        #status-conexao { font-size: 12px; color: #aaa; margin-bottom: 15px; }
        .online { color: green !important; font-weight: bold; }

        /* Menu */
        .menu { margin-bottom: 20px; display: flex; justify-content: center; gap: 10px; }
        .menu button { padding: 12px 20px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; flex: 1; max-width: 150px; }
        .btn-ativo { background: #d32f2f; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .btn-inativo { background: #e0e0e0; color: #333; }
        
        .tela { display: none; }
        .tela.ativa { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* GLOBO */
        .globo {
            font-size: 80px; font-weight: bold; color: white;
            background: #d32f2f; width: 150px; height: 150px;
            line-height: 150px; border-radius: 50%; margin: 20px auto;
            border: 5px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            transition: 0.3s;
        }
        .globo.agitando { animation: tremer 0.5s infinite; background: #ff9800; }
        @keyframes tremer { 0% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); } }

        .btn-acao { background: #28a745; color: white; padding: 15px 30px; font-size: 20px; border: none; border-radius: 50px; cursor: pointer; width: 80%; max-width: 300px; }
        .btn-acao:disabled { background: #ccc; cursor: not-allowed; }

        /* CARTELA */
        .cartela-container { max-width: 350px; margin: 0 auto; background: white; padding: 10px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #d32f2f; color: white; padding: 10px; font-size: 20px; }
        td { border: 1px solid #ddd; height: 50px; width: 20%; font-size: 22px; cursor: pointer; transition: background 0.3s; }
        td.marcado-auto { background-color: #ffeb3b; color: #d32f2f; font-weight: bold; }
        td.marcado-manual { border: 3px solid #28a745; }
        td.free { background: #ddd; font-size: 12px; }

        .aviso { color: red; font-weight: bold; min-height: 20px; margin-top: 10px;}
        .grid-historico { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; max-width: 400px; margin: 20px auto; }
        .bolinha-hist { font-size: 12px; padding: 5px; background: #eee; border-radius: 4px; }
        .bolinha-hist.saiu { background: #333; color: #fff; font-weight: bold; }
    </style>
</head>
<body>

    <h1>ðŸŽ± Bingo da FamÃ­lia</h1>
    <div id="status-conexao">Conectando ao servidor...</div>

    <div class="menu">
        <button onclick="mudarTela('jogador')" id="btn-jogador" class="btn-ativo">Minha Cartela</button>
        <button onclick="verificarAcessoAdm()" id="btn-mesa" class="btn-inativo">ðŸ”’ Mesa (ADM)</button>
    </div>

    <div id="tela-jogador" class="tela ativa">
        <div class="cartela-container">
            <table>
                <thead><tr><th>B</th><th>I</th><th>N</th><th>G</th><th>O</th></tr></thead>
                <tbody id="corpo-cartela"></tbody>
            </table>
        </div>
        <br>
        <button onclick="gerarNovaCartela()" style="background:#555; color:white; padding:10px; border-radius:5px;">Gerar Nova Cartela</button>
        <p style="font-size:12px; color:#666;">Os nÃºmeros serÃ£o marcados automaticamente!</p>
    </div>

    <div id="tela-mesa" class="tela">
        <div class="globo" id="globo-numero">--</div>
        <div class="aviso" id="aviso-mesa"></div>
        <button class="btn-acao" id="btn-sortear" onclick="iniciarSorteioAnimado()">Sortear NÃºmero</button>
        <br><br>
        <button onclick="reiniciarPartidaGlobal()" style="background:#d32f2f; color:white; padding:8px 15px; border-radius:5px;">Reiniciar Partida (ZERA TUDO)</button>
        <h3>HistÃ³rico</h3>
        <div class="grid-historico" id="grid-historico"></div>
    </div>

<script>
    // ======================================================
    // âš ï¸ PREENCHA AQUI SEUS DADOS (SEM APAGAR AS ASPAS) âš ï¸
    // ======================================================
    const firebaseConfig = {
        apiKey: "SUA_API_KEY_AQUI", 
        authDomain: "bingofamilia-7a112.firebaseapp.com",
        
        // AQUI ESTÃ A URL CORRIGIDA (SEM O :NULL)
        databaseURL: "https://bingofamilia-7a112-default-rtdb.firebaseio.com",
        
        projectId: "bingofamilia-7a112",
        storageBucket: "bingofamilia-7a112.appspot.com",
        messagingSenderId: "123456...",
        appId: "1:123456..."
    };
    // ======================================================

    // INICIALIZAÃ‡ÃƒO SEGURA DO FIREBASE
    if (typeof firebase === 'undefined') {
        alert("ERRO: O Firebase nÃ£o carregou. Verifique sua internet.");
    } else {
        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        var db = firebase.database();
    }

    const SENHA_ADM = "1234";
    let numerosSorteados = [];

    // --- ESCUTAR O BANCO DE DADOS (REAL TIME) ---
    if(db) {
        db.ref('bingo/estado').on('value', (snapshot) => {
            const statusDiv = document.getElementById('status-conexao');
            statusDiv.innerText = "ðŸŸ¢ Conectado e Sincronizado";
            statusDiv.classList.add('online');

            const dados = snapshot.val();
            if (dados) {
