<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo da Fam√≠lia</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background: #fafafa; margin: 0; padding: 20px; user-select: none; }
        h1 { color: #d32f2f; margin-bottom: 10px; }
        
        /* Menu de Navega√ß√£o */
        .menu { margin-bottom: 20px; display: flex; justify-content: center; gap: 10px; }
        .menu button {
            padding: 12px 20px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; flex: 1; max-width: 150px; transition: 0.2s;
        }
        .btn-ativo { background: #d32f2f; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.2); transform: scale(1.05); }
        .btn-inativo { background: #e0e0e0; color: #333; }
        
        /* Telas */
        .tela { display: none; animation: fadeIn 0.4s; }
        .tela.ativa { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ANIMA√á√ÉO DO GLOBO (NOVO) --- */
        @keyframes tremer {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-5deg); }
            20% { transform: translate(-3px, 0px) rotate(5deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(5deg); }
            50% { transform: translate(-1px, 2px) rotate(-5deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-5deg); }
            80% { transform: translate(-1px, -1px) rotate(5deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .globo {
            font-size: 80px; font-weight: bold; color: white;
            background: #d32f2f; width: 150px; height: 150px;
            line-height: 150px; border-radius: 50%; margin: 20px auto;
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.3), 0 10px 20px rgba(0,0,0,0.2);
            transition: background 0.3s;
            border: 5px solid white;
        }

        /* Classe que ativa a anima√ß√£o */
        .globo.agitando {
            animation: tremer 0.5s infinite; /* Treme infinitamente enquanto tiver a classe */
            background: #ff9800; /* Muda para laranja enquanto gira */
            color: #fff;
        }
        
        .btn-acao { 
            background: #28a745; color: white; padding: 15px 30px; 
            font-size: 20px; border: none; border-radius: 50px; cursor: pointer; width: 80%; max-width: 300px;
            box-shadow: 0 4px 0 #218838; transition: transform 0.1s;
        }
        .btn-acao:active { transform: translateY(4px); box-shadow: none; }
        .btn-acao:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; }

        /* Cartela */
        .cartela-container { max-width: 350px; margin: 0 auto; background: white; padding: 10px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #d32f2f; color: white; padding: 10px; font-size: 20px; border-radius: 5px 5px 0 0; }
        td { border: 1px solid #ddd; height: 50px; width: 20%; font-size: 22px; cursor: pointer; }
        td.marcado { background-color: #ffeb3b; color: #d32f2f; font-weight: bold; position: relative; }
        /* X vermelho na marca√ß√£o */
        td.marcado::after { content: '‚úï'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.3; font-size: 30px; }
        td.free { background: #ddd; font-size: 12px; }

        /* Hist√≥rico */
        .grid-historico {
            display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; margin-top: 20px; max-width: 400px; margin-left: auto; margin-right: auto;
        }
        .bolinha-hist { font-size: 12px; padding: 5px; background: #eee; border-radius: 4px; color: #ccc; }
        .bolinha-hist.saiu { background: #333; color: #fff; font-weight: bold; transform: scale(1.1); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        
        .aviso { color: red; margin-top: 10px; font-weight: bold; min-height: 20px;}
        .area-botoes-mesa { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
    </style>
</head>
<body>

    <h1>üé± Bingo da Fam√≠lia</h1>

    <div class="menu">
        <button onclick="mudarTela('jogador')" id="btn-jogador" class="btn-ativo">Minha Cartela</button>
        <button onclick="verificarAcessoAdm()" id="btn-mesa" class="btn-inativo">üîí Mesa (ADM)</button>
    </div>

    <div id="tela-jogador" class="tela ativa">
        <div class="cartela-container">
            <table>
                <thead>
                    <tr><th>B</th><th>I</th><th>N</th><th>G</th><th>O</th></tr>
                </thead>
                <tbody id="corpo-cartela"></tbody>
            </table>
        </div>
        <br>
        <button onclick="gerarCartela()" style="background:#555; color:white; padding:10px 20px; border:none; border-radius:5px; cursor: pointer;">Gerar Nova Cartela</button>
        <p style="font-size:12px; color:#666;">Toque nos n√∫meros para marcar!</p>
    </div>

    <div id="tela-mesa" class="tela">
        <div class="globo" id="ultimo-numero">--</div>
        
        <div class="aviso" id="aviso-fim"></div>

        <button class="btn-acao" id="btn-sortear" onclick="animarSorteio()">Sortear N√∫mero</button>
        
        <div class="area-botoes-mesa">
            <button onclick="reiniciarJogo()" style="background:#d32f2f; color:white; padding:8px 15px; border:none; border-radius:5px; cursor:pointer;">Reiniciar Jogo</button>
            <button onclick="sairMesa()" style="background:#777; color:white; padding:8px 15px; border:none; border-radius:5px; cursor:pointer;">Sair da Mesa</button>
        </div>
        
        <h3 style="margin-top: 30px; border-top: 1px solid #ccc; padding-top: 10px;">Hist√≥rico</h3>
        <div class="grid-historico" id="grid-historico"></div>
    </div>

<script>
    const SENHA_ADM = "1234"; 

    // --- L√ìGICA DE ANIMA√á√ÉO E SORTEIO ---
    function animarSorteio() {
        let numerosDisponiveis = JSON.parse(localStorage.getItem('bingo_disponiveis')) || [];
        
        if (numerosDisponiveis.length === 0) {
            // Se for o primeiro jogo, inicializa
             if(!localStorage.getItem('bingo_iniciado')) {
                 iniciarMesa();
                 // Pega a lista atualizada
                 numerosDisponiveis = JSON.parse(localStorage.getItem('bingo_disponiveis'));
             } else {
                 document.getElementById('aviso-fim').innerText = "Fim do Jogo! Todos os n√∫meros foram sorteados.";
                 return;
             }
        }

        const btn = document.getElementById('btn-sortear');
        const globo = document.getElementById('ultimo-numero');
        
        // 1. Bloqueia o bot√£o para n√£o clicar duas vezes
        btn.disabled = true;
        btn.innerText = "Girando...";
        
        // 2. Adiciona classe CSS que faz tremer e mudar de cor
        globo.classList.add('agitando');

        // 3. Efeito de n√∫meros passando r√°pido (Slot Machine)
        let contador = 0;
        const intervalo = setInterval(() => {
            // Mostra um n√∫mero aleat√≥rio qualquer s√≥ para efeito visual
            globo.innerText = Math.floor(Math.random() * 75) + 1;
            contador++;
        }, 80); // Muda a cada 80 milissegundos

        // 4. Para a anima√ß√£o ap√≥s 3 segundos e mostra o n√∫mero real
        setTimeout(() => {
            clearInterval(intervalo);
            globo.classList.remove('agitando');
            
            // CHAMA O SORTEIO REAL
            sortearNumeroReal();
            
            btn.disabled = false;
            btn.innerText = "Sortear N√∫mero";
        }, 3000); // 3000ms = 3 segundos de suspense
    }

    function sortearNumeroReal() {
        let numerosSorteados = JSON.parse(localStorage.getItem('bingo_sorteados')) || [];
        let numerosDisponiveis = JSON.parse(localStorage.getItem('bingo_disponiveis')) || [];

        if (numerosDisponiveis.length === 0) return;

        let indice = Math.floor(Math.random() * numerosDisponiveis.length);
        let numero = numerosDisponiveis.splice(indice, 1)[0];
        numerosSorteados.push(numero);

        localStorage.setItem('bingo_iniciado', 'true');
        salvarEstado(numerosSorteados, numerosDisponiveis);
        atualizarInterfaceMesa(numero, numerosSorteados);
    }

    // --- FUN√á√ïES DE INTERFACE ---
    function atualizarInterfaceMesa(ultimo, listaSorteados) {
        if (!listaSorteados) listaSorteados = JSON.parse(localStorage.getItem('bingo_sorteados')) || [];
        if (!ultimo && listaSorteados.length > 0) ultimo = listaSorteados[listaSorteados.length - 1];

        document.getElementById('ultimo-numero').innerText = ultimo ? ultimo : '--';

        const grid = document.getElementById('grid-historico');
        grid.innerHTML = '';
        for(let i=1; i<=75; i++) {
            let div = document.createElement('div');
            div.className = 'bolinha-hist ' + (listaSorteados.includes(i) ? 'saiu' : '');
            div.innerText = i;
            grid.appendChild(div);
        }
    }

    // --- OUTRAS FUN√á√ïES DE SISTEMA ---
    function verificarAcessoAdm() {
        if(document.getElementById('tela-mesa').classList.contains('ativa')) return;
        let tentativa = prompt("Digite a senha do organizador:");
        if (tentativa === SENHA_ADM) { mudarTela('mesa'); } 
        else if (tentativa !== null) { alert("Senha incorreta!"); }
    }

    function sairMesa() { mudarTela('jogador'); }

    function gerarCartela() {
        if(!confirm("Gerar nova cartela? Voc√™ perder√° as marca√ß√µes atuais.")) return;
        renderizarCartela();
    }
    
    function renderizarCartela() {
        const corpo = document.getElementById('corpo-cartela');
        corpo.innerHTML = '';
        let colB = pegarNumerosAleatorios(1, 15, 5);
        let colI = pegarNumerosAleatorios(16, 30, 5);
        let colN = pegarNumerosAleatorios(31, 45, 4);
        let colG = pegarNumerosAleatorios(46, 60, 5);
        let colO = pegarNumerosAleatorios(61, 75, 5);
        for (let i = 0; i < 5; i++) {
            let tr = document.createElement('tr');
            let nVal = (i === 2) ? 'FREE' : (i > 2 ? colN[i-1] : colN[i]);
            let valores = [colB[i], colI[i], nVal, colG[i], colO[i]];
            valores.forEach((val) => {
                let td = document.createElement('td');
                td.innerText = val;
                if(val === 'FREE') td.className = 'free';
                td.onclick = function() { if (this.innerText !== 'FREE') this.classList.toggle('marcado'); };
                tr.appendChild(td);
            });
            corpo.appendChild(tr);
        }
    }

    function pegarNumerosAleatorios(min, max, qtd) {
        let nums = [];
        while(nums.length < qtd){
            let r = Math.floor(Math.random() * (max - min + 1)) + min;
            if(nums.indexOf(r) === -1) nums.push(r);
        }
        return nums;
    }

    function iniciarMesa() {
        let numsDisp = [];
        for (let i = 1; i <= 75; i++) numsDisp.push(i);
        salvarEstado([], numsDisp);
        atualizarInterfaceMesa(null, []);
    }

    function reiniciarJogo() {
        let confirmacao = prompt("Para confirmar o rein√≠cio, digite 'ZERA':");
        if(confirmacao && confirmacao.toUpperCase() === 'ZERA') {
            iniciarMesa();
            document.getElementById('aviso-fim').innerText = "";
            localStorage.removeItem('bingo_iniciado');
        }
    }

    function salvarEstado(sorteados, disponiveis) {
        localStorage.setItem('bingo_sorteados', JSON.stringify(sorteados));
        localStorage.setItem('bingo_disponiveis', JSON.stringify(disponiveis));
    }

    function mudarTela(tipo) {
        document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa'));
        document.getElementById('tela-' + tipo).classList.add('ativa');
        document.getElementById('btn-jogador').className = tipo === 'jogador' ? 'btn-ativo' : 'btn-inativo';
        document.getElementById('btn-mesa').className = tipo === 'mesa' ? 'btn-ativo' : 'btn-inativo';
    }

    // Inicializa√ß√£o
    if(document.getElementById('corpo-cartela').innerHTML === "") renderizarCartela();
    atualizarInterfaceMesa();

</script>
</body>
</html>
