<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Diagn√≥stico</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üé±</text></svg>">

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        body { font-family: monospace; text-align: center; background: #222; color: #fff; padding: 20px; }
        .log-box { 
            background: #000; border: 1px solid #444; padding: 15px; 
            text-align: left; height: 300px; overflow-y: scroll; margin-bottom: 20px;
            font-size: 14px;
        }
        .sucesso { color: #0f0; }
        .erro { color: #f55; font-weight: bold; }
        .aviso { color: #ff0; }
        
        button { padding: 15px; cursor: pointer; font-size: 16px; margin: 5px; }
    </style>
</head>
<body>

    <h1>üïµÔ∏è Modo Diagn√≥stico</h1>
    <p>Veja abaixo o que est√° acontecendo:</p>

    <div class="log-box" id="console-tela">Aguardando in√≠cio...<br></div>

    <div id="status-final" style="font-size: 20px; margin: 20px;">üü† TESTANDO...</div>

    <div id="controles" style="display:none; border-top: 1px solid #555; padding-top: 20px;">
        <h2>üéâ SUCESSO! O BINGO FUNCIONOU!</h2>
        <p>Se voc√™ v√™ isso, a conex√£o est√° perfeita.</p>
        <button onclick="realizarSorteioTeste()">Testar Sorteio (Enviar pro Banco)</button>
        <div id="ultimo-sorteado" style="font-size: 50px; color: yellow; margin-top: 10px;">--</div>
    </div>

<script>
    // Fun√ß√£o para escrever na tela preta
    function log(msg, tipo="normal") {
        const box = document.getElementById('console-tela');
        const linha = document.createElement('div');
        linha.innerHTML = `> ${msg}`;
        if(tipo === 'erro') linha.className = 'erro';
        if(tipo === 'sucesso') linha.className = 'sucesso';
        box.appendChild(linha);
        console.log(msg);
    }

    log("Iniciando script...");

    // ======================================================
    // ‚ö†Ô∏è PREENCHA SEUS DADOS AQUI COM CUIDADO ‚ö†Ô∏è
    // ======================================================
    const firebaseConfig = {
        apiKey: "SUA_API_KEY_AQUI", 
        authDomain: "bingofamilia-7a112.firebaseapp.com",
        databaseURL: "https://bingofamilia-7a112-default-rtdb.firebaseio.com", 
        projectId: "bingofamilia-7a112",
        storageBucket: "bingofamilia-7a112.appspot.com",
        messagingSenderId: "123456...",
        appId: "1:123456..."
    };
    // ======================================================

    let db;

    try {
        // 1. Verificar Bibliotecas
        if (typeof firebase === 'undefined') {
            throw new Error("Bibliotecas do Firebase N√ÉO foram carregadas. Verifique sua internet ou bloqueadores de an√∫ncio.");
        }
        log("Bibliotecas carregadas OK.", "sucesso");

        // 2. Inicializar App
        if (!firebase.apps.length) { 
            firebase.initializeApp(firebaseConfig); 
            log("Firebase inicializado.", "sucesso");
        }
        
        // 3. Instanciar Banco
        db = firebase.database();
        log("Banco de dados instanciado.", "sucesso");

        // 4. Teste de Conex√£o M√°gica (.info/connected)
        log("Tentando conectar ao servidor...", "aviso");
        
        db.ref(".info/connected").on("value", function(snap) {
            if (snap.val() === true) {
                log("üü¢ CONECTADO AO GOOGLE FIREBASE!", "sucesso");
                document.getElementById('status-final').innerHTML = "üü¢ CONECTADO!";
                document.getElementById('status-final').style.color = "#0f0";
                document.getElementById('controles').style.display = "block";
            } else {
                log("üî¥ Desconectado. Tentando reconectar...", "aviso");
                document.getElementById('status-final').innerHTML = "üî¥ DESCONECTADO";
            }
        });

        // 5. Escutar dados do Bingo
        db.ref('bingo/estado').on('value', (snapshot) => {
            log("Recebi dados do banco!", "sucesso");
            const dados = snapshot.val();
            if(dados && dados.sorteados) {
                const ultimo = dados.sorteados[dados.sorteados.length - 1];
                document.getElementById('ultimo-sorteado').innerText = ultimo;
                log(`√öltimo n√∫mero recebido: ${ultimo}`);
            }
        }, (error) => {
            log(`ERRO DE PERMISS√ÉO: ${error.message}`, "erro");
            log("Verifique se as REGRAS do banco est√£o como true.", "erro");
        });

    } catch (e) {
        log(`ERRO FATAL: ${e.message}`, "erro");
    }

    function realizarSorteioTeste() {
        if(!db) return;
        const num = Math.floor(Math.random() * 75) + 1;
        log(`Enviando n√∫mero ${num} para o banco...`);
        db.ref('bingo/estado').set({
            sorteados: [num],
            data: new Date().toString()
        }).catch(e => log(`Erro ao salvar: ${e.message}`, "erro"));
    }

</script>
</body>
</html>
